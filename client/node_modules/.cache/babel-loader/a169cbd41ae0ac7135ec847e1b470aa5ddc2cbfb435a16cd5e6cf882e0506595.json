{"ast":null,"code":"import _regeneratorRuntime from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"E:/WhatsApp clone/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3;import{Box,styled}from\"@mui/material\";import React,{useContext,useRef}from\"react\";import Footer from\"./Footer\";import{AccountContext}from\"../context/AccountProvider\";import{useState}from\"react\";import{newMessage,getMessages}from\"../service/api\";import{useEffect}from\"react\";import Message from\"./Message\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Wrapper=styled(Box)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n    background-image: url(\",\");\\n    background-size: 50%;\\n\"])),'https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');var Component=styled(Box)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\nheight: 78.75vh;\\noverflow-y: scroll;\\n\"])));var Container=styled(Box)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\npadding: 1px 8px;\\n\"])));var Messages=function Messages(_ref){var person=_ref.person,conversation=_ref.conversation;var _useContext=useContext(AccountContext),messageFlag=_useContext.messageFlag,setMessageFlag=_useContext.setMessageFlag;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var _useContext2=useContext(AccountContext),account=_useContext2.account,socket=_useContext2.socket;var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),file=_useState6[0],setFile=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),image=_useState8[0],setImage=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),incomingMessage=_useState10[0],setIncomingMessage=_useState10[1];var scrollRef=useRef();useEffect(function(){socket.current.on('getMessage',function(data){setIncomingMessage(_objectSpread(_objectSpread({},data),{},{createdAt:Date.now()}));});},[]);useEffect(function(){var _scrollRef$current;(_scrollRef$current=scrollRef.current)===null||_scrollRef$current===void 0?void 0:_scrollRef$current.scrollIntoView({transition:\"smooth\"});},[messages]);useEffect(function(){var _conversation$members;incomingMessage&&(conversation===null||conversation===void 0?void 0:(_conversation$members=conversation.members)===null||_conversation$members===void 0?void 0:_conversation$members.includes(incomingMessage.senderId))&&setMessages(function(prev){return[].concat(_toConsumableArray(prev),[incomingMessage]);});},[incomingMessage,conversation]);useEffect(function(){var getMessageDetails=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getMessages(conversation._id);case 2:data=_context.sent;console.log(data);setMessages(data);case 5:case\"end\":return _context.stop();}},_callee);}));return function getMessageDetails(){return _ref2.apply(this,arguments);};}();conversation._id&&getMessageDetails();},[person._id,conversation._id,messageFlag]);var sendText=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var code,message;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:code=e.keyCode||e.which;if(!(code===13)){_context2.next=11;break;}message={};if(!file){message={senderId:account.sub,receiverId:person.sub,conversationId:conversation._id,type:'text',text:value};}else{message={senderId:account.sub,conversationId:conversation._id,receiverId:person.sub,type:'file',text:image};}socket.current.emit('sendMessage',message);_context2.next=7;return newMessage(message);case 7:setValue(\"\");setFile(\"\");setImage(\"\");setMessageFlag(!messageFlag);case 11:case\"end\":return _context2.stop();}},_callee2);}));return function sendText(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Wrapper,{children:[/*#__PURE__*/_jsx(Component,{children:messages&&messages.map(function(message){return/*#__PURE__*/_jsx(Container,{ref:scrollRef,children:/*#__PURE__*/_jsx(Message,{message:message})});})}),/*#__PURE__*/_jsx(Footer,{sendText:sendText,setValue:setValue,value:value,file:file,setFile:setFile,image:image,setImage:setImage})]});};export default Messages;","map":{"version":3,"names":["Box","styled","React","useContext","useRef","Footer","AccountContext","useState","newMessage","getMessages","useEffect","Message","jsx","_jsx","jsxs","_jsxs","Wrapper","_templateObject","_taggedTemplateLiteral","Component","_templateObject2","Container","_templateObject3","Messages","_ref","person","conversation","_useContext","messageFlag","setMessageFlag","_useState","_useState2","_slicedToArray","value","setValue","_useState3","_useState4","messages","setMessages","_useContext2","account","socket","_useState5","_useState6","file","setFile","_useState7","_useState8","image","setImage","_useState9","_useState10","incomingMessage","setIncomingMessage","scrollRef","current","on","data","_objectSpread","createdAt","Date","now","_scrollRef$current","scrollIntoView","transition","_conversation$members","members","includes","senderId","prev","concat","_toConsumableArray","getMessageDetails","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","next","_id","sent","console","log","stop","apply","arguments","sendText","_ref3","_callee2","e","code","message","_callee2$","_context2","keyCode","which","sub","receiverId","conversationId","type","text","emit","_x","children","map","ref"],"sources":["E:/WhatsApp clone/client/src/chat/Messages.js"],"sourcesContent":["import { Box, styled } from \"@mui/material\";\r\nimport React, { useContext, useRef } from \"react\";\r\nimport Footer from \"./Footer\";\r\nimport { AccountContext } from \"../context/AccountProvider\";\r\nimport { useState } from \"react\";\r\nimport { newMessage, getMessages } from \"../service/api\";\r\nimport { useEffect } from \"react\";\r\nimport Message from \"./Message\";\r\n\r\n\r\nconst Wrapper = styled(Box)`\r\n    background-image: url(${'https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'});\r\n    background-size: 50%;\r\n`;\r\nconst Component=styled(Box)`\r\nheight: 78.75vh;\r\noverflow-y: scroll;\r\n`\r\n\r\nconst Container=styled(Box)`\r\npadding: 1px 8px;\r\n`\r\n\r\nconst Messages=({person, conversation})=>{\r\n\r\n    const {messageFlag, setMessageFlag}=useContext(AccountContext);\r\n\r\n    const [value, setValue]=useState(\"\");\r\n\r\n    const [messages, setMessages]=useState([]);\r\n\r\n    const {account, socket}=useContext(AccountContext);\r\n\r\n    const [file, setFile]=useState();\r\n\r\n    const [image, setImage]=useState(\"\");\r\n\r\n    const [incomingMessage, setIncomingMessage] = useState(null);\r\n\r\n    const scrollRef=useRef();\r\n\r\n    useEffect(() => {\r\n        socket.current.on('getMessage', data => {\r\n            setIncomingMessage({\r\n                ...data,\r\n                createdAt: Date.now()\r\n            })\r\n        })\r\n    }, []);\r\n\r\n    useEffect(()=>{\r\n        scrollRef.current?.scrollIntoView({transition: \"smooth\"});\r\n    }, [messages]);\r\n\r\n    useEffect(() => {\r\n        incomingMessage && conversation?.members?.includes(incomingMessage.senderId) && \r\n            setMessages((prev) => [...prev, incomingMessage]);\r\n        \r\n    }, [incomingMessage, conversation]);\r\n\r\n    useEffect(()=>{\r\n        const getMessageDetails=async ()=>{\r\n            let data=await getMessages(conversation._id);\r\n            console.log(data);\r\n            setMessages(data);\r\n        }\r\n        conversation._id && getMessageDetails();\r\n    }, [person._id, conversation._id, messageFlag]);\r\n\r\n    const sendText=async (e)=>{ \r\n        const code=e.keyCode || e.which;\r\n        if(code===13){\r\n            let message={};\r\n            if (!file) {\r\n                message = {\r\n                    senderId: account.sub,\r\n                    receiverId: person.sub,\r\n                    conversationId: conversation._id,\r\n                    type: 'text',\r\n                    text: value\r\n                };\r\n            } else {\r\n                message = {\r\n                    senderId: account.sub,\r\n                    conversationId: conversation._id,\r\n                    receiverId: person.sub,\r\n                    type: 'file',\r\n                    text: image\r\n                };\r\n            }\r\n\r\n            socket.current.emit('sendMessage', message);\r\n\r\n            await newMessage(message);\r\n\r\n            setValue(\"\");\r\n            setFile(\"\");\r\n            setImage(\"\");\r\n\r\n            setMessageFlag(!messageFlag);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Wrapper>\r\n            <Component>\r\n            {\r\n                messages && messages.map(message=>(\r\n                    <Container ref={scrollRef}>\r\n                    <Message message={message}/>\r\n                    </Container>\r\n                ))\r\n            }\r\n            </Component>\r\n            <Footer \r\n            sendText={sendText}\r\n            setValue={setValue}\r\n            value={value}\r\n            file={file}\r\n            setFile={setFile}\r\n            image={image}\r\n            setImage={setImage}\r\n            />\r\n        </Wrapper>\r\n    );\r\n}\r\n\r\nexport default Messages;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}